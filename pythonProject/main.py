import telebot
from telebot import types
import wikipedia
import re
import random

bot = telebot.TeleBot('7061253604:AAFnjVwo7Og6v5QLTwufmqSMKoAPK4REoyg')

# –°–ª–æ–≤–∞—Ä—å –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
user_state = {}
user_scores = {}
current_questions = {}
# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
def get_user_state(message):
    return user_state.get(message.chat.id)

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
def set_user_state(message, state):
    user_state[message.chat.id] = state

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ä—É—Å—Å–∫–∏–π —è–∑—ã–∫ –≤ Wikipedia
wikipedia.set_lang("ru")

magic_ball_answers = [
    '–î—É–º–∞—é, –¥–∞!',
    '–ù–µ —Å—Ç–æ–∏—Ç.',
    '–Ø —Å–æ–º–Ω–µ–≤–∞—é—Å—å –≤ —ç—Ç–æ–º',
    '–í–µ—Ä–æ—è—Ç–Ω–æ, –¥–∞',
    '–ë–µ—Å—Å–ø–æ—Ä–Ω–æ',
    '–ù–µ –º–æ–≥—É —Å–∫–∞–∑–∞—Ç—å',
    '–ù–µ —Å–µ–π—á–∞—Å',
    '–õ—É—á—à–µ –Ω–µ –Ω–∞–¥–æ',
    '–†–µ—à–∏—Ç–µ–ª—å–Ω–æ, –¥–∞!'
]
quiz_questions = {
    1: {
        'question': '–°—Ç–æ–ª–∏—Ü–∞ –§—Ä–∞–Ω—Ü–∏–∏?',
        'answers': ['–ú–æ—Å–∫–≤–∞', '–ü–∞—Ä–∏–∂', '–ë–µ—Ä–ª–∏–Ω', '–õ–æ–Ω–¥–æ–Ω'],
        'correct': '–ü–∞—Ä–∏–∂'
    },
    2: {
        'question': '2 + 2 * 2?',
        'answers': ['6', '8', '4', '2'],
        'correct': '6'
    },
    3: {
        'question': '–°–∫–æ–ª—å–∫–æ —Ü–≤–µ—Ç–æ–≤ –≤ —Ä–∞–¥—É–≥–µ?',
        'answers': ['6', '8', '4', '2'],
        'correct': '7'
    },
    4: {
        'question': '–°–æ–ª–Ω—Ü–µ - –∑–≤–µ–∑–¥–∞ –∏–ª–∏ –ø–ª–∞–Ω–µ—Ç–∞?',
        'answers': ['–∑–≤–µ–∑–¥–∞', '–ø–ª–∞–Ω–µ—Ç–∞'],
        'correct': '–∑–≤–µ–∑–¥–∞'
    },
    5: {
        'question': '–ö–∞–∫–æ–≥–æ –∏—é–Ω—è –æ—Ç–º–µ—á–∞–µ—Ç—Å—è –¥–µ–Ω—å –∑–∞—â–∏—Ç—ã –¥–µ—Ç–µ–π?',
        'answers': ['6', '8', '4', '2'],
        'correct': '1'
    },
    6: {
        'question': '–ö–∞–∫–æ–π –æ–≤–æ—â –Ω–∞–∑—ã–≤–∞—é—Ç –≤—Ç–æ—Ä—ã–º —Ö–ª–µ–±–æ–º?',
        'answers': ['–º–æ—Ä–∫–æ–≤—å', '–∫–∞–ø—É—Å—Ç–∞', '–æ–≥—É—Ä–µ—Ü', '–∫–∞—Ä—Ç–æ—à–∫–∞'],
        'correct': '–∫–∞—Ä—Ç–æ—à–∫–∞'
    },
    7: {
        'question': '–í –∫–∞–∫–æ–π —Å—Ç—Ä–∞–Ω–µ —Å–∞–º–æ–µ –±–æ–ª—å—à–æ–µ –Ω–∞—Å–µ–ª–µ–Ω–∏–µ –º–∏—Ä–∞?',
        'answers': ['–§—Ä–∞–Ω—Ü–∏—è', '–ö–∏—Ç–∞–π', '–ê—Ñ—Ä–∏–∫–∞', '–†–æ—Å—Å–∏—è'],
        'correct': '–ö–∏—Ç–∞–π'
    },
    8: {
        'question': '–° –∫–∞–∫–æ–≥–æ –º–µ—Å—è—Ü–∞ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –∑–∏–º–∞?',
        'answers': ['–º–∞—Ä—Ç', '—Ñ–µ–≤—Ä–∞–ª—å', '—è–Ω–≤–∞—Ä—å', '–¥–µ–∫–∞–±—Ä—å'],
        'correct': '–¥–µ–∫–∞–±—Ä—å'
    },
    9: {
        'question': '–ó–∞ –∫–∞–∫–æ–π –Ω–æ—Ç–æ–π –∏–¥–µ—Ç "–º–∏"?',
        'answers': ['–¥–æ', '—Å–æ–ª—å', '–ª—è', '—Ä–µ'],
        'correct': '—Ä–µ'
    },
}
anecdotes = [
    '–ü—Ä–∏–Ω—Ü –ø–æ—Ü–µ–ª–æ–≤–∞–ª –∏ —Ä–∞–∑–±—É–¥–∏–ª –ø—Ä–∏–Ω—Ü–µ—Å—Å—É, —Ç–∞ –≤—ã—Ä—É–±–∏–ª–∞ –µ–≥–æ –∏ –ø–µ—Ä–µ—Å—Ç–∞–≤–∏–ª–∞ –µ—â—ë –Ω–∞ 5 –º–∏–Ω—É—Ç.',
    '–†–æ—Å—Å–∏—è–Ω–µ –º–µ—á—Ç–∞–ª–∏ –≤–µ—Ä–Ω—É—Ç—å—Å—è –≤ –°–°–°–†, –∫–æ–≥–¥–∞ –±—ã–ª–æ –≤—Å—ë –¥–µ—à–µ–≤–æ–µ. –ò –≤–æ—Ç —Ç–µ–ø–µ—Ä—å —É –Ω–∏—Ö –º–Ω–æ–≥–æ –¥–µ—à–µ–≤–æ–π –Ω–µ—Ñ—Ç–∏, –¥–µ—à–µ–≤–æ–≥–æ –≥–∞–∑–∞, –¥–µ—à–µ–≤–æ–≥–æ –∑–æ–ª–æ—Ç–∞ –∏ –¥–µ—à–µ–≤—ã—Ö —Ä—É–±–ª–µ–π.',
    '–í —Å–µ—Ç–∏ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤ "–ï–¥–∏–º –∫–∞–∫ –¥–æ–º–∞" –∑–∞—Å—Ç–∞–≤–ª—è—é—Ç –Ω–µ —Ç–æ–ª—å–∫–æ –¥–æ–µ–¥–∞—Ç—å –≤—Å—ë –¥–æ –∫–æ–Ω—Ü–∞, –Ω–æ –∏ –º—ã—Ç—å –ø–æ—Å–ª–µ —ç—Ç–æ–≥–æ –ø–æ—Å—É–¥—É.',
    '–°–µ–≥–æ–¥–Ω—è —Å—Ç–æ–ª—å–∫–æ –∑–∞–ø—Ä–µ—Ç–æ–≤... –¢–æ –Ω–µ–ª—å–∑—è, —ç—Ç–æ –Ω–µ–ª—å–∑—è...–Ø —Å–æ–≤—Å–µ–º —Ä–∞—Å—Ç–µ—Ä—è–ª—Å—è. –û–ø—É–±–ª–∏–∫—É–π—Ç–µ, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, —Å–ø–∏—Å–æ–∫ —Ç–æ–≥–æ, —á—Ç–æ –º–æ–∂–Ω–æ. –û–Ω –≤–µ–¥—å –Ω–µ–±–æ–ª—å—à–æ–π –ø–æ–ª—É—á–∏—Ç—Å—è. –ó–∞—Ä–∞–Ω–µ–µ –±–ª–∞–≥–æ–¥–∞—Ä—é.',
    '–ó–Ω–∞–µ—Ç–µ, –ø–æ—á–µ–º—É —É –ù–µ–∫—Ä–∞—Å–æ–≤–∞ —Å—Ç–∏—Ö–æ—Ç–≤–æ—Ä–µ–Ω–∏–µ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è ¬´–†–∞–∑–º—ã—à–ª–µ–Ω–∏—è —É –ø–∞—Ä–∞–¥–Ω–æ–≥–æ –ø–æ–¥—ä–µ–∑–¥–∞¬ª? –û–Ω –ø—Ä–æ—Å—Ç–æ —Ö–æ—Ç–µ–ª –ø—Ä–æ–¥–∞–≤–∞—Ç—å –∫–Ω–∏–≥–∏ –≤ –æ–±–µ–∏—Ö —Å—Ç–æ–ª–∏—Ü–∞—Ö.',
    '–ü—Ä–∏ –≤–∏–¥–µ –¥–∏–≤–∞–Ω–∞ —Ö–æ—á–µ—Ç—Å—è –ª–µ—á—å. –ü—Ä–∏ –≤–∏–¥–µ –≤–æ–¥—ã - –ø–∏—Ç—å. –ü—Ä–∏ –≤–∏–¥–µ –µ–¥—ã - –µ—Å—Ç—å. –ê –≤–æ—Ç —Å —Ä–∞–±–æ—Ç–æ–π —á—Ç–æ-—Ç–æ –Ω–µ —Ç–∞–∫!',
    '- –î–æ—Ä–æ–≥–∞—è, —Å 13 —Ñ–µ–≤—Ä–∞–ª—è –ø–æ 9 –º–∞—Ä—Ç–∞ –º–µ–Ω—è –±—É–¥—É—Ç –∏—Å–∫–∞—Ç—å –≤—Ä–∞–≥–∏. –ü—Ä–æ—Å—Ç–∏, –º—ã –Ω–µ —Å–º–æ–∂–µ–º —É–≤–∏–¥–µ—Ç—å—Å—è.',
    '–ö–æ–≥–¥–∞ —É –º–µ–Ω—è —Å–ø—Ä–∞—à–∏–≤–∞—é—Ç –≤–æ–∑—Ä–∞—Å—Ç, —è –æ—Ç–≤–µ—á–∞—é: —è –Ω–∞—Å—Ç–æ–ª—å–∫–æ —Å—Ç–∞—Ä–∞—è, —á—Ç–æ –ø–æ–º–Ω—é, –∫–∞–∫ HR –Ω–∞–∑—ã–≤–∞–ª–∏ "–æ—Ç–¥–µ–ª –∫–∞–¥—Ä–æ–≤".',
    '–ò–∑–±–µ–≥–∞–π—Ç–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ —Å –ø–æ–∂–∏–ª—ã–º–∏ –ª—é–¥—å–º–∏, —Å –≤–æ–∑—Ä–∞—Å—Ç–æ–º –∏—Ö –≤—Å–µ –º–µ–Ω—å—à–µ –ø—É–≥–∞–µ—Ç —Ç—é—Ä–µ–º–Ω–æ–µ –Ω–∞–∫–∞–∑–∞–Ω–∏–µ.',
    '–î—É–º–∞—é, —á–µ–≥–æ –¥–µ–Ω—å-—Ç–æ —Ç–∞–∫–æ–π —Ö–æ—Ä–æ—à–∏–π... –ü–æ—Ç–æ–º –≤—Å–ø–æ–º–Ω–∏–ª: —è –∂–µ –Ω–∞ —É—Å–ø–æ–∫–æ–∏—Ç–µ–ª—å–Ω—ã—Ö.',
    '–£ –º–µ–Ω—è —Å–ª–æ–º–∞–ª—Å—è —Ç—É–∞–ª–µ—Ç. –ó–≤–æ–Ω—é —Å–∞–Ω—Ç–µ—Ö–Ω–∏–∫—É, –∞ –æ–Ω –º–Ω–µ –≥–æ–≤–æ—Ä–∏—Ç: "–ù–µ —Å—Å—ã, —â–∞ –ø—Ä–∏–µ–¥—É".',
    '–ü–æ—Å–ª–µ –æ–∫–æ–Ω—á–∞–Ω–∏—è –∫—É—Ä—Å–æ–≤ –ø–µ–∫–∞—Ä–µ–π –≤—ã–¥–∞—ë—Ç—Å—è –∫–æ—Ä–æ—á–∫–∞.',
    '–ù–µ —Ö–æ—á—É - —ç—Ç–æ –∫—Ä–∞—Å–∏–≤–∞—è, –ª–∞–∫–æ–Ω–∏—á–Ω–∞—è —Ñ—Ä–∞–∑–∞. –ù–µ –ø–æ–Ω–∏–º–∞—é, –ø–æ—á–µ–º—É –µ—ë –ø–µ—Ä–µ—Å—Ç–∞–ª–∏ –≤–æ—Å–ø—Ä–∏–Ω–∏–º–∞—Ç—å –∫–∞–∫ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∞—Ä–≥—É–º–µ–Ω—Ç, –∏ –Ω—É–∂–Ω–æ –ø–µ—Ä–µ—á–∏—Å–ª—è—Ç—å –ø–æ–≤–æ–¥—ã, –º–æ—Ç–∏–≤—ã, –ø—Ä–∏–ª–∞–≥–∞—Ç—å –ø—è—Ç–∏—Å—Ç—Ä–∞–Ω–∏—á–Ω–æ–µ —ç—Å—Å–µ —Å –æ–±—ä—è—Å–Ω–µ–Ω–∏—è–º–∏...',
    '–° –ø–æ—è–≤–ª–µ–Ω–∏–µ–º —Ä–æ–±–æ—Ç–∞-–ø—ã–ª–µ—Å–æ—Å–∞ –≤ –∫–≤–∞—Ä—Ç–∏—Ä–µ —Å—Ç–∞–ª–æ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —á–∏—â–µ, —Ç–∞–∫ –∫–∞–∫ –ø—Ä–∏—Ö–æ–¥–∏—Ç—Å—è —É–±–∏—Ä–∞—Ç—å —Å –ø–æ–ª–∞ –≤—Å–µ —Ä–∞–∑–±—Ä–æ—Å–∞–Ω–Ω—ã–µ –≤–µ—â–∏.'
]
# –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å—Ç–∞—Ä—Ç–æ–≤–æ–π –∫–æ–º–∞–Ω–¥—ã
@bot.message_handler(commands=['start'])
def send_welcome(message):
    markup = types.ReplyKeyboardMarkup(resize_keyboard=True)
    item1 = types.KeyboardButton('–í–∏–∫—Ç–æ—Ä–∏–Ω–∞')
    item2 = types.KeyboardButton('–ê–Ω–µ–∫–¥–æ—Ç—ã')
    item3 = types.KeyboardButton('–ú–∞–≥–∏—á–µ—Å–∫–∏–π —à–∞—Ä')
    item4 = types.KeyboardButton('–í–∏–∫–∏–ø–µ–¥–∏—è')
    item5 = types.KeyboardButton('–§–∞–∫—Ç—ã')

    markup.add(item1, item2, item3, item4, item5)
    bot.send_message(message.chat.id, f'–ü—Ä–∏–≤–µ—Ç, {message.from_user.first_name}! –ß–µ–º —Å–µ–≥–æ–¥–Ω—è –∑–∞–π–º–µ–º—Å—è?', reply_markup=markup)
    # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∫–∞–∫ True, —Ä–∞–∑—Ä–µ—à–∞—è –¥–æ—Å—Ç—É–ø –∫ –∫–Ω–æ–ø–∫–∞–º
    set_user_state(message, True)

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ –∏–∑ Wikipedia
def get_wiki_content(query):
    try:
        page = wikipedia.page(query)
        wikitext = page.content[:1000].split('.')
        wikitext = [sentence + '.' for sentence in wikitext if not '==' in sentence and len(sentence.strip()) > 3]
        wikitext = ' '.join(wikitext)
        wikitext = re.sub(r'\([^()]*\)', '', wikitext)
        wikitext = re.sub(r'\{[^\{\}]*\}', '', wikitext)
        return wikitext
    except Exception as e:
        return '–í —ç–Ω—Ü–∏–∫–ª–æ–ø–µ–¥–∏–∏ –Ω–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ–± —ç—Ç–æ–º'


# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
@bot.message_handler(func=lambda message: get_user_state(message) and message.text == '–í–∏–∫–∏–ø–µ–¥–∏—è')
def handle_wikipedia_command(message):
    # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∫–∞–∫ '–í–∏–∫–∏–ø–µ–¥–∏—è', —Ä–∞–∑—Ä–µ—à–∞—è –ø–æ–∏—Å–∫
    set_user_state(message, '–í–∏–∫–∏–ø–µ–¥–∏—è')
    bot.send_message(message.chat.id, '–û—Ç–ø—Ä–∞–≤—å –º–Ω–µ —Å–ª–æ–≤–æ –¥–ª—è –ø–æ–∏—Å–∫–∞ –≤ –í–∏–∫–∏–ø–µ–¥–∏–∏.')

# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è –ø–æ–∏—Å–∫–∞ –≤ –í–∏–∫–∏–ø–µ–¥–∏–∏
@bot.message_handler(func=lambda message: get_user_state(message) == '–í–∏–∫–∏–ø–µ–¥–∏—è')
def handle_wikipedia_search(message):
    bot.send_message(message.chat.id, get_wiki_content(message.text))
    # –ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø–æ–∏—Å–∫–∞ —Å–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    set_user_state(message, True)

# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è –ú–∞–≥–∏—á–µ—Å–∫–æ–≥–æ —à–∞—Ä–∞
@bot.message_handler(func=lambda message: get_user_state(message) and message.text == '–ú–∞–≥–∏—á–µ—Å–∫–∏–π —à–∞—Ä')
def handle_magic_ball_command(message):
    # –ü–µ—Ä–µ–≤–æ–¥–∏–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ —Ä–µ–∂–∏–º –ú–∞–≥–∏—á–µ—Å–∫–æ–≥–æ —à–∞—Ä–∞
    set_user_state(message, '–ú–∞–≥–∏—á–µ—Å–∫–∏–π —à–∞—Ä')
    bot.send_message(message.chat.id, '–°–ø—Ä–æ—Å–∏ –º–µ–Ω—è –æ —á—ë–º —É–≥–æ–¥–Ω–æ! –Ø –ø–æ–º–æ–≥—É –ø—Ä–∏–Ω—è—Ç—å —Ä–µ—à–µ–Ω–∏–µ!')

# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –æ—Ç–≤–µ—Ç–∞ –æ—Ç –ú–∞–≥–∏—á–µ—Å–∫–æ–≥–æ —à–∞—Ä–∞
@bot.message_handler(func=lambda message: get_user_state(message) == '–ú–∞–≥–∏—á–µ—Å–∫–∏–π —à–∞—Ä')
def handle_magic_ball_answer(message):
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å–æ–¥–µ—Ä–∂–∏—Ç –ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤–æ–ø—Ä–æ—Å–∏—Ç–µ–ª—å–Ω—ã–π –∑–Ω–∞–∫
    if '?' in message.text:
        # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–ª—É—á–∞–π–Ω—ã–π –æ—Ç–≤–µ—Ç –∏–∑ —Å–ø–∏—Å–∫–∞
        bot.send_message(message.chat.id, random.choice(magic_ball_answers))
    else:
        # –ü—Ä–æ—Å–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∑–∞–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å
        bot.send_message(message.chat.id, '–ù–µ –ø–æ–Ω–∏–º–∞—é –æ —á–µ–º —Ç—ã... –ü—Ä–æ—Å—Ç–æ –∑–∞–¥–∞–π –≤–æ–ø—Ä–æ—Å')
    # –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    set_user_state(message, True)
@bot.message_handler(func=lambda message: not get_user_state(message))
def handle_text(message):
    # –ï—Å–ª–∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–Ω–æ–ø–∫–∏, –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
    bot.send_message(message.chat.id, '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –Ω–∞–∂–º–∏ –Ω–∞ –∫–Ω–æ–ø–∫—É "—Å—Ç–∞—Ä—Ç", —á—Ç–æ–±—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–æ—Ç–∞.')
# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è –∫–Ω–æ–ø–∫–∏ '–í–∏–∫—Ç–æ—Ä–∏–Ω–∞'
@bot.message_handler(func=lambda message: get_user_state(message) and message.text == '–í–∏–∫—Ç–æ—Ä–∏–Ω–∞')
def handle_quiz_button(message):
    question_num = random.choice(list(quiz_questions.keys()))
    current_questions[message.chat.id] = question_num
    send_quiz_question(message, question_num)

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤–æ–ø—Ä–æ—Å–∞ –≤–∏–∫—Ç–æ—Ä–∏–Ω—ã
def send_quiz_question(message, question_num):
    question_data = quiz_questions[question_num]
    bot.send_message(message.chat.id, question_data['question'])
    set_user_state(message, '–í–∏–∫—Ç–æ—Ä–∏–Ω–∞_–û–∂–∏–¥–∞–Ω–∏–µ_–û—Ç–≤–µ—Ç–∞')

# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è –æ—Ç–≤–µ—Ç–æ–≤ –Ω–∞ –≤–∏–∫—Ç–æ—Ä–∏–Ω—É
@bot.message_handler(func=lambda message: get_user_state(message) == '–í–∏–∫—Ç–æ—Ä–∏–Ω–∞_–û–∂–∏–¥–∞–Ω–∏–µ_–û—Ç–≤–µ—Ç–∞')
def handle_quiz_answer(message):
    question_num = current_questions.get(message.chat.id)
    if question_num is not None:
        correct_answer = quiz_questions[question_num]['correct']
        if message.text.strip().lower() == correct_answer.lower():
            bot.send_message(message.chat.id, '–ü—Ä–∞–≤–∏–ª—å–Ω–æ! –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –≤–æ–ø—Ä–æ—Å—É... üëç')
            # –í—ã–±–∏—Ä–∞–µ–º —Å–ª–µ–¥—É—é—â–∏–π –≤–æ–ø—Ä–æ—Å
            next_question_num = random.choice(list(quiz_questions.keys()))
            while next_question_num == question_num:  # –£–±–µ–¥–∏–º—Å—è, —á—Ç–æ –≤–æ–ø—Ä–æ—Å –Ω–µ –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è
                next_question_num = random.choice(list(quiz_questions.keys()))
            current_questions[message.chat.id] = next_question_num
            send_quiz_question(message, next_question_num)
        else:
            bot.send_message(message.chat.id, '–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ. –í–∏–∫—Ç–æ—Ä–∏–Ω–∞ –æ–∫–æ–Ω—á–µ–Ω–∞. üò¢')
            set_user_state(message, True)
            del current_questions[message.chat.id]
# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –∞–Ω–µ–∫–¥–æ—Ç–æ–≤
def send_anecdote(message):
    index = random.randint(0, len(anecdotes) - 1)
    bot.send_message(message.chat.id, anecdotes[index])
    set_user_state(message, '–ê–Ω–µ–∫–¥–æ—Ç—ã')

# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è –∫–Ω–æ–ø–∫–∏ '–ê–Ω–µ–∫–¥–æ—Ç—ã'
@bot.message_handler(func=lambda message: get_user_state(message) and message.text == '–ê–Ω–µ–∫–¥–æ—Ç—ã')
def handle_anecdotes_button(message):
    send_anecdote(message)

# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ª–µ–¥—É—é—â–µ–≥–æ –∞–Ω–µ–∫–¥–æ—Ç–∞
@bot.message_handler(func=lambda message: get_user_state(message) == '–ê–Ω–µ–∫–¥–æ—Ç—ã')
def handle_next_anecdote(message):
    if message.text.lower() == '–µ—â–µ':
        send_anecdote(message)
    else:
        bot.send_message(message.chat.id, '–ù–µ –ø–æ–Ω–∏–º–∞—é. –ï—Å–ª–∏ —Ö–æ—á–µ—à—å —É—Å–ª—ã—à–∞—Ç—å –µ—â–µ –∞–Ω–µ–∫–¥–æ—Ç, –Ω–∞–ø–∏—à–∏—Ç–µ "–µ—â–µ".')
        set_user_state(message, True)
# –î–æ–±–∞–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ —Ñ–∞–∫—Ç–æ–≤
facts = [
    '–°–∞–º–æ–µ –±–æ–ª—å—à–æ–µ –∂–∏–≤–æ—Ç–Ω–æ–µ –Ω–∞ –ø–ª–∞–Ω–µ—Ç–µ - —Å–∏–Ω–∏–π –∫–∏—Ç.',
    '–í–æ–¥–∞ —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç –æ–∫–æ–ª–æ 60% –≤–µ—Å–∞ —á–µ–ª–æ–≤–µ—á–µ—Å–∫–æ–≥–æ —Ç–µ–ª–∞.',
    '–ú–µ–¥ - –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –ø—Ä–æ–¥—É–∫—Ç –ø–∏—Ç–∞–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ –ø–æ—Ä—Ç–∏—Ç—Å—è.',
    '–°–∞–º–æ–µ –º–∞–ª–µ–Ω—å–∫–æ–µ –º–ª–µ–∫–æ–ø–∏—Ç–∞—é—â–µ–µ –≤ –º–∏—Ä–µ - –±–∞–º–±—É–∫–æ–≤—ã–π –ª–µ—Ç—É—á–∏–π –ª–µ–º—É—Ä.',
    '–û–∫–æ–ª–æ 70% –∫–∏—Å–ª–æ—Ä–æ–¥–∞ –Ω–∞ –ó–µ–º–ª–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è –æ–∫–µ–∞–Ω–∞–º–∏.',
    '–ö–æ—Ñ–µ–∏–Ω - —Å–∞–º—ã–π –ø–æ–ø—É–ª—è—Ä–Ω—ã–π –ø—Å–∏—Ö–æ–∞–∫—Ç–∏–≤–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –≤ –º–∏—Ä–µ.',
    '–ë–∞–Ω–∞–Ω—ã - —ç—Ç–æ —è–≥–æ–¥—ã, –∞ –∫–ª—É–±–Ω–∏–∫–∞ - –Ω–µ—Ç.',
    '–°–∞–º–æ–µ –¥–ª–∏–Ω–Ω–æ–µ —Å–ª–æ–≤–æ –≤ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ —Å–æ–¥–µ—Ä–∂–∏—Ç 35 –±—É–∫–≤ - "—ç–ª–µ–∫—Ç—Ä–æ—Ñ–æ—Ç–æ–ø–æ–ª—É–ø—Ä–æ–≤–æ–¥–Ω–∏–∫–æ–≤—ã–π".',
    '–í–µ–Ω–µ—Ä–∞ - –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–∞—è –ø–ª–∞–Ω–µ—Ç–∞ –≤ –°–æ–ª–Ω–µ—á–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ, –∫–æ—Ç–æ—Ä–∞—è –≤—Ä–∞—â–∞–µ—Ç—Å—è –≤–æ–∫—Ä—É–≥ —Å–≤–æ–µ–π –æ—Å–∏ –≤ –æ–±—Ä–∞—Ç–Ω–æ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–∏.',
    '–°–∞–º–æ–µ –≥–ª—É–±–æ–∫–æ–µ –º–µ—Å—Ç–æ –≤ –æ–∫–µ–∞–Ω–µ - –ú–∞—Ä–∏–∞–Ω—Å–∫–∞—è –≤–ø–∞–¥–∏–Ω–∞, –µ—ë –≥–ª—É–±–∏–Ω–∞ –ø—Ä–µ–≤—ã—à–∞–µ—Ç 11 –∫–∏–ª–æ–º–µ—Ç—Ä–æ–≤.'
]
# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–∞–∫—Ç–æ–≤
def send_fact(message):
    index = random.randint(0, len(facts) - 1)
    bot.send_message(message.chat.id, facts[index])
    set_user_state(message, '–§–∞–∫—Ç—ã')

# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è –∫–Ω–æ–ø–∫–∏ '–§–∞–∫—Ç—ã'
@bot.message_handler(func=lambda message: get_user_state(message) and message.text == '–§–∞–∫—Ç—ã')
def handle_facts_button(message):
    send_fact(message)

# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ª–µ–¥—É—é—â–µ–≥–æ —Ñ–∞–∫—Ç–∞
@bot.message_handler(func=lambda message: get_user_state(message) == '–§–∞–∫—Ç—ã')
def handle_next_fact(message):
    if message.text.lower() == '–µ—â–µ':
        send_fact(message)
    else:
        bot.send_message(message.chat.id, '–ù–µ –ø–æ–Ω–∏–º–∞—é. –ï—Å–ª–∏ —Ö–æ—á–µ—à—å —É–∑–Ω–∞—Ç—å –µ—â–µ —Ñ–∞–∫—Ç, –Ω–∞–ø–∏—à–∏—Ç–µ "–µ—â–µ".')
        set_user_state(message, True)


bot.polling(none_stop=True)
